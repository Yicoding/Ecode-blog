<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>addUser</title>
	<!-- <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-default/index.css"> -->
	<link href="http://cdn.bootcss.com/element-ui/1.4.2/theme-default/index.css" rel="stylesheet">
	<style>
		html body {
			padding: 0;
			margin: 0;
		}
		header {
		    background: #324157;
		    width: 100%;
		    color: white;
		    text-align: center;
		    line-height: 50px;
		  }
		  section {
		    margin: 50px 30px 0 0; 
		  }
	</style>
</head>
<body>
	<div id="main">
		<header>
    		欢迎来到注册界面
	    </header>
	    <section v-loading="loading" element-loading-text="正在跳转，请稍后">
	    	<el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
	    	  <el-form-item label="用户名" prop="name">
	    	    <el-input v-model.number="ruleForm.name"></el-input>
	    	  </el-form-item>
	    	  <el-form-item label="年龄" prop="age">
	    	    <el-input v-model.number="ruleForm.age"></el-input>
	    	  </el-form-item>
	    	  <el-form-item label="密码" prop="password">
	    	    <el-input type="password" v-model="ruleForm.password" auto-complete="off"></el-input>
	    	  </el-form-item>
	    	  <el-form-item label="确认密码" prop="checkPass">
	    	    <el-input type="password" v-model="ruleForm.checkPass" auto-complete="off"></el-input>
	    	  </el-form-item>
	    	  <el-form-item>
	    	    <el-button type="primary" @click="submitForm('ruleForm')" v-text="btns.one"></el-button>
	    	    <el-button @click="resetForm('ruleForm')" v-text="btns.two"></el-button>
	    	    <el-button @click="cancel" type="warning" v-text="btns.three"></el-button>
	    	  </el-form-item>
	    	</el-form>
	    </section>
	</div>
	<script src="http://cdn.bootcss.com/vue/2.4.2/vue.js"></script>
	<!-- <script src="https://unpkg.com/element-ui/lib/index.js"></script> -->
	<script src="http://cdn.bootcss.com/element-ui/1.4.2/index.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
		new Vue({
			el: '#main',
			data() {
		      var checkAge = (rule, value, callback) => {
		        if (!value) {
		          return callback(new Error('年龄不能为空'));
		        }
		        setTimeout(() => {
		          if (!Number.isInteger(value)) {
		            callback(new Error('请输入数字值'));
		          } else {
		            if (value < 18) {
		              callback(new Error('必须年满18岁'));
		            } else {
		              callback();
		            }
		          }
		        }, 1000);
		      };
		      var validatePass = (rule, value, callback) => {
		        if (value === '') {
		          callback(new Error('请输入密码'));
		        } else {
		          if (this.ruleForm.checkPass !== '') {
		            this.$refs.ruleForm.validateField('checkPass');
		          }
		          callback();
		        }
		      };
		      var validatePass2 = (rule, value, callback) => {
		        if (value === '') {
		          callback(new Error('请再次输入密码'));
		        } else if (value !== this.ruleForm.password) {
		          callback(new Error('两次输入密码不一致!'));
		        } else {
		          callback();
		        }
		      };
		      return {
		      	loading: false,
		        ruleForm: {
		          name: '',
		          age: '',
		          password: '',
		          checkPass: '',
		          role_id: 3
		        },
		        rules: {
		          name: [
		            { required: true, message: '请输入用户名', trigger: 'blur' }
		          ],
		          password: [
		            { required: true, validator: validatePass, trigger: 'blur' }
		          ],
		          checkPass: [
		            { required: true, validator: validatePass2, trigger: 'blur' }
		          ],
		          age: [
		            { required: true, validator: checkAge, trigger: 'blur' }
		          ]
		        },
		        btns: {
		        	one: '提交',
		        	two: '重置',
		        	three: '取消'
		        },
		      };
		    },
			methods: {
				submitForm(formName) {
			        this.$refs[formName].validate((valid) => {
			          if (valid) {
			            axios.post('/api/user/add', this.ruleForm).then((res) => {
			            	console.log(JSON.stringify(res.data))
			            	this.$message({
					          showClose: true,
					          message: '恭喜你，注册成功，3秒后自动跳转到登录界面',
					          type: 'success'
					        });
					        setTimeout(() => {
					        	window.location.href = '/login'
					        }, 3000)
			            }).catch((err) => {
			            	this.$message({
					          showClose: true,
					          message: '用户名已存在，请取一个独一无二的个性名称',
					          type: 'error'
					        });
			            })
			          } else {
			            console.log('error submit!!');
			            return false;
			          }
			        });
		      	},
		      	resetForm(formName) {
			        this.$refs[formName].resetFields();
		      	},
		      	cancel () {
		      		this.loading = true
			      	window.location.href = '/login'
		      	}
			},
		})
	</script>
</body>
</html>